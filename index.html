<!doctype html>
<html>
  <head>
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>INTERNET TEMPLE</title>
    <link rel="shortcut icon" type="image/png" href="http://i.imgur.com/wds0irK.png"/>
    <style media="screen">
      body {
        background-repeat: repeat;
        background-image: url("images/background.png");
        background-size: cover;
        background-repeat:repeat;
      }
      h3 {
        text-align: center;
      }
      p {
        text-align: center;
      }
      a:link {
          color: white;
          text-decoration:none;
      }
      a:visited {
          color: white;
      }
      a:hover {
          color: hotpink;
      }
      #frame {
        pointer-events: none;
        top: 0px;
        position: absolute;
        margin-left: auto;
        margin-right: auto;
        left: 0;
        right: 0;
      }
      #video {
        top: 0px;
        position: absolute;
        margin-left: auto;
        margin-right: auto;
        left: 0;
        right: 0;
        z-index: -1;
      }
      #chat-window {
        top: 425px;
        position: absolute;
        margin-left: auto;
        margin-right: auto;
        left: 0;
        right: 0;
        z-index: -1;
      }
      #chat-input-window {
        top: 576px;
        position: absolute;
        margin-left: auto;
        margin-right: auto;
        left: 0;
        right: 0;
        z-index: -1;
      }
      #chat {
        pointer-events: none;
        display: block;
        resize: none;
        height: 196px;
        width: 600px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 430px;
        background:transparent;
        outline:none;
        border:none;
        color: white;
        font-family: monospace;
        font-size: 16pt;
        overflow: hidden;
      }
      #chat-input {
        display: block;
        resize: none;
        height: 25px;
        width: 600px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 23px;
        background:transparent;
        outline:none;
        border:none;
        color: white;
        font-family: monospace;
        font-size: 16pt;
      }
    </style>
  </head>
  <body>
    <img id='frame' src="images/frame.png" alt="An ornate frame." />
    <iframe id="video" width="640" height="360" src="" frameborder="0" allowfullscreen></iframe>
    <img id='chat-window' src="images/chat-window.png" alt="A simple box." />
    <textarea id="chat">
** Welcome to the Internet Temple!
** You can use /name to set your username.
** Internet Temple is a online music venue.
   DM @tobyalden on Twitter to perform here!
    </textarea>
    <img id='chat-input-window' src="images/chat-input-window.png" alt="A small, long box." />
    <input id="chat-input" type="text" autofocus="true">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      $(function() {
        var username = localStorage.getItem('internet-temple-username');
        var socket = io();
        console.log("Welcome to INTERNET TEMPLE...")
        socket.emit("request current embed");
        socket.on("embed submission", function(embedCode) {
            $('#video').attr('src', embedCode);
        });
        socket.on("send current embed", function(currentEmbed) {
          console.log("...please enjoy your stay.");
          $('#video').attr('src', currentEmbed.currentEmbed);

          if(username === null) {
            username = currentEmbed.newUsername;
            localStorage.setItem('internet-temple-username', username);
          }
        });

        socket.on("get chat message", function(message) {
          $("#chat").val($("#chat").val() + "\n" + message);
          $('#chat').scrollTop($('#chat')[0].scrollHeight);
        });
        $(document).keypress(function(e) {
          if(e.which == 13) {
            message = $("#chat-input").val();
            if(message.startsWith('/name')) {
              var oldUsername = username;
              username = message.split('/name')[1].substring(0, 30).trim();
              localStorage.setItem('internet-temple-username', username);
              socket.emit("send chat message", oldUsername + " changed names to " + username + ".");
            }
            else {
              socket.emit("send chat message", username + ": " + message);
            }
            $("#chat-input").val("");
          }
        });
      });
    </script>
  </body>
</html>
