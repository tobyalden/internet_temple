<!doctype html>
<html>
  <head>
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>INTERNET TEMPLE</title>
    <link rel="shortcut icon" type="image/png" href="http://i.imgur.com/wds0irK.png"/>
    <style media="screen">
      body {
        background-repeat: repeat;
        background-image: url("images/background.png");
        background-size: cover;
        background-repeat:repeat;
        margin: 0px;
        padding: 0px;
      }
      .container {
          width: 100vw;
          height: 100vh;
          display: flex;
          justify-content: space-between;
          align-items: center;
          flex-direction: column;

      }
      h3 {
        text-align: center;
      }
      p {
        text-align: center;
      }
      a:link {
          color: white;
          text-decoration:none;
      }
      a:visited {
          color: white;
      }
      a:hover {
          color: hotpink;
      }
      #frame {
        pointer-events: none;
        position: absolute;
        top: 0px;
        width: 100%;
      }
      #video {
        /* pointer-events: auto; */
        width: 90%;
        height: 100%;
      }
      .video-container, .chat-container, .chat-input-container {
          width: 52%;
      }
      .video-container {
          height: 29.25vw;
          /* height: 800px; */
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          /* pointer-events: auto; */
      }
    .chat-container, .chat-input-container {
        border: 1px solid white;
        border-radius: 6px;
        background-color: black;
    }

    .chat-container {
        margin-top: 8vw;
        height: 100%;
        min-height: 100px;
        overflow: hidden;
        /* pointer-events: none; */
    }
    .chat-input-container {
        margin-top: 8px;
        margin-bottom: 40px;
    }
    #chat-input, #chat {
        color: white;
        font-family: monospace;
        font-size: 1.2em;
        background-color: rgba(0,0,0,0);
        width: 98%;
    }
    #chat-input {
        height: 24px;
        border: none;
        outline: none;
    }
    #chat {
        height: 100%;
        border: none;
        resize: none;
        /* pointer-events: none; */
    }
    @media (max-width: 1000px) {
        .container {
            width: 98vw;
            height: 80vh;
            margin-left: auto;
            margin-right: auto;
        }
        .video-container, .chat-container, .chat-input-container {
            width: 100%;
        }
        .video-container {
            width: 100vw;
            height: 56vw;
            min-height: 56vw;
            /* height: 800px; */
        }
        .chat-container {
            margin-top: 16vw;
        }
        .chat-input-container {
            margin-bottom: 8px;
        }
    }
</style>
  </head>
  <body>
      <div class="container">
          <div class="video-container">
              <iframe id="video" src="" frameborder="0"></iframe>
              <img id='frame' src="images/frame.png" alt="An ornate frame." />
          </div>
          <div class="chat-container">
              <textarea id="chat">
** Welcome to the Internet Temple!
** You can use /name to set your username.
** Internet Temple is a online music venue.
** DM @tobyalden on Twitter or @daveblanket on Instagram to perform here!
              </textarea>
          </div>
          <div class="chat-input-container">
              <input id="chat-input" type="text" autofocus="true" placeholder="Enter chat messages here">
          </div>
      </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
    window.addEventListener("orientationchange", function() {
        if (window.orientation == 270 || window.orientation == 90) {
            var elem = document.getElementById("video");

            /* When the openFullscreen() function is executed, open the video in fullscreen.
            Note that we must include prefixes for different browsers, as they don't support the requestFullscreen method yet */
            function openFullscreen() {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.mozRequestFullScreen) { /* Firefox */
                    elem.mozRequestFullScreen();
                } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) { /* IE/Edge */
                    elem.msRequestFullscreen();
                }
            }

            // openFullscreen();
        }
        if (window.orientation == 0 || window.orientation == 180) {
            var elem = document.getElementById("video");

            /* When the openFullscreen() function is executed, open the video in fullscreen.
            Note that we must include prefixes for different browsers, as they don't support the requestFullscreen method yet */
            function closeFullscreen() {
              if (document.exitFullscreen) {
                document.exitFullscreen();
              } else if (document.mozCancelFullScreen) { /* Firefox */
                document.mozCancelFullScreen();
              } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                document.webkitExitFullscreen();
              } else if (document.msExitFullscreen) { /* IE/Edge */
                document.msExitFullscreen();
              }
            }

            // closeFullscreen();
        }
    }, false);
    </script>
    <script>
      $(function() {
        var username = localStorage.getItem('internet-temple-username');
        var socket = io();
        console.log("Welcome to INTERNET TEMPLE...")
        socket.emit("request current embed");
        socket.on("embed submission", function(embedCode) {
            $('#video').attr('src', embedCode);
        });
        socket.on("send current embed", function(currentEmbed) {
          console.log("...please enjoy your stay.");
          $('#video').attr('src', currentEmbed.currentEmbed);

          if(username === null) {
            username = currentEmbed.newUsername;
            localStorage.setItem('internet-temple-username', username);
          }
        });

        socket.on("get chat message", function(message) {
          $("#chat").val($("#chat").val() + "\n" + message);
          $('#chat').scrollTop($('#chat')[0].scrollHeight);
        });
        $(document).keypress(function(e) {
          if(e.which == 13) {
            message = $("#chat-input").val();
            if(message.startsWith('/name')) {
              var oldUsername = username;
              username = message.split('/name')[1].substring(0, 30).trim();
              localStorage.setItem('internet-temple-username', username);
              socket.emit("send chat message", oldUsername + " changed names to " + username + ".");
            }
            else {
              socket.emit("send chat message", username + ": " + message);
            }
            $("#chat-input").val("");
          }
        });
      });
    </script>
  </body>
</html>
